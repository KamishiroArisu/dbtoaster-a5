<project name="Cumulus" default="main" basedir=".">
  <property name="src"   location="src" />
  <property name="build" location="build" />
  <property name="bin"   location="bin" />
  <property name="jar"   location="${bin}/cumulus.jar" />
  <property file="local.properties" />
  
  <path id="classpath">
    <pathelement path="${jruby.home}/lib/jruby.jar" />
    <pathelement path="lib/je.jar" />
  </path>
  
  <target name="init">
    <mkdir dir="${build}" />
    <mkdir dir="${bin}" />
    <copy todir="${bin}">
      <fileset dir="${src}/tools">
        <include name="**/*.sh" />
      </fileset>
    </copy>
    <chmod dir="${bin}" includes="**/*.sh" perm="+w" />
    
    <pathconvert refid="classpath" property="compile.classpath" />
    <property name="run.classpath" value="${compile.classpath}:${jar}" />
    <exec executable="src/tools/make_launchers.sh">
      <arg value="${run.classpath}" />
    </exec>
  </target>
  
  <target name="main" depends="init">
    <javac srcdir="${src}/java" destdir="${build}" classpathref="classpath" debug="true" />
    <jar destfile="${jar}">
      <fileset dir="${build}" />
      <fileset dir="${src}/ruby" />
    </jar>
  </target>
  
  <target name="clean">
    <delete dir="${build}" />
    <delete dir="${bin}" />
  </target>
</project>