open Util
open K3OCamlgen
open K3
open K3.SR

;;

let tcode ?(t=K3O.Float) txt = (IP.Leaf("<<"^txt^">>"),t);;
let code_list = List.map tcode ["x";"y";"z"];;
let arg_list = List.map (fun x -> ("<<"^x^">>",K3.SR.TFloat)) ["x";"y";"z"];;

module K3OC = K3Compiler.Make(K3OCamlgen.K3CG)

;;

let test_compile name args program expected =
   ()

(*   let code = K3OC.compile_k3_expr program in
   let text = K3CG.debug_string code in
   let cmd = "open Database"^
             "module MC = K3ValuationMap "^"module DB = NamedK3Database "^
             "let "^name^" "^
             (Util.string_of_list " " (List.map (fun x -> "var_"^x) args))^
             " = "^text in
   let (out_c) = Unix.open_process_out "./dbtoaster_top" in
      print_string cmd;
      output_string out_c cmd;
      flush out_c
      
*)
;;

let on_insert_t (*QUERY_1_1R1S1T_T__C,QUERY_1_1R1S1T_D*) = K3.SR.Block[
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",(K3.SR.TFloat))),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",(K3.SR.TFloat)),(K3.SR.Add((K3.SR.Var("current_v",(K3.SR.TFloat))),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ])),(K3.SR.Var("QUERY_1_1R1S1T_D",(K3.SR.TFloat))))))))),(K3.SR.SingletonPC("QUERY_1_1",(K3.SR.TFloat))))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",(K3.SR.TFloat))),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",(K3.SR.TFloat)),(K3.SR.Add((K3.SR.Var("current_v",(K3.SR.TFloat))),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",(K3.SR.TFloat)),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[  ],[ (K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ],(K3.SR.Var("init_val",(K3.SR.TFloat))))); (K3.SR.Var("init_val",(K3.SR.TFloat))) ])))),(K3.SR.Const(M3.CFloat(0.))))),(K3.SR.Var("QUERY_1_1R1S1T_D",(K3.SR.TFloat))))))))),(K3.SR.SingletonPC("QUERY_1_1",(K3.SR.TFloat))))))));
K3.SR.Iterate((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1R_R__B",(K3.SR.TFloat); "updated_v",(K3.SR.TFloat) ]),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R_R__B",(K3.SR.TFloat) ],(K3.SR.TFloat))),[  ],[ (K3.SR.Var("QUERY_1_1R_R__B",(K3.SR.TFloat))) ],(K3.SR.Var("updated_v",(K3.SR.TFloat))))))),(K3.SR.Map((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1R_R__B",(K3.SR.TFloat); "dv",(K3.SR.TFloat) ]),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R_R__B",(K3.SR.TFloat) ],(K3.SR.TFloat))),[ (K3.SR.Var("QUERY_1_1R_R__B",(K3.SR.TFloat))) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1R_R__B",(K3.SR.TFloat))); (K3.SR.Add((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R_R__B",(K3.SR.TFloat) ],(K3.SR.TFloat))),[ (K3.SR.Var("QUERY_1_1R_R__B",(K3.SR.TFloat))) ])),(K3.SR.Var("dv",(K3.SR.TFloat))))) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1R_R__B",(K3.SR.TFloat))); (K3.SR.Add((K3.SR.Const(M3.CFloat(0.))),(K3.SR.Var("dv",(K3.SR.TFloat))))) ])))))),(K3.SR.GroupByAggregate((K3.SR.AssocLambda(K3.SR.ATuple([ "QUERY_1_1R_R__B",(K3.SR.TFloat); "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat); "v2",(K3.SR.TFloat) ]),K3.SR.AVar("accv",(K3.SR.TFloat)),(K3.SR.Add((K3.SR.Mult((K3.SR.Var("QUERY_1_1R1S1T_D",(K3.SR.TFloat))),(K3.SR.Var("v2",(K3.SR.TFloat))))),(K3.SR.Var("accv",(K3.SR.TFloat))))))),(K3.SR.Const(M3.CFloat(0.))),(K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1R_R__B",(K3.SR.TFloat); "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat); "v2",(K3.SR.TFloat) ]),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1R_R__B",(K3.SR.TFloat))) ])))),(K3.SR.Slice((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R_R__B",(K3.SR.TFloat); "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[ "QUERY_1_1R_R__B",(K3.SR.TFloat); "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],([ "QUERY_1_1R1S1T_T__C",(K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ]))))))));
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[  ],[ (K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",(K3.SR.TFloat)),(K3.SR.Add((K3.SR.Var("current_v",(K3.SR.TFloat))),(K3.SR.Var("QUERY_1_1R1S1T_D",(K3.SR.TFloat))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",(K3.SR.TFloat) ],(K3.SR.TFloat))),[  ],[ (K3.SR.Var("QUERY_1_1R1S1T_T__C",(K3.SR.TFloat))) ],(K3.SR.Add((K3.SR.Var("QUERY_1_1R1S1T_D",(K3.SR.TFloat))),(K3.SR.Const(M3.CFloat(0.))))))))
]
   

;;


(*
ON_insert_S(QUERY_1_1R1T1S_S__B,QUERY_1_1R1T1S_S__C)
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))))),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))))),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Add((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.Const(0.)))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Add((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(0.)))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])))))))),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Add((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.Const(0.)))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Add((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(0.)))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Const(1.)))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Add((K3.SR.Const(1.)),(K3.SR.Const(0.)))))))

ON_insert_R(QUERY_1_1S1R_A,QUERY_1_1S1R_R__B)
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))))
K3.SR.Iterate((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1T_T__C",Float; "updated_v",Float ]),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1T_T__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1T_T__C")) ],(K3.SR.Var("updated_v")))))),(K3.SR.Map((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1T_T__C",Float; "dv",Float ]),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1T_T__C")) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1T_T__C")); (K3.SR.Add((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1T_T__C")) ])),(K3.SR.Var("dv")))) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1T_T__C")); (K3.SR.Add((K3.SR.Const(0.)),(K3.SR.Var("dv")))) ])))))),(K3.SR.GroupByAggregate((K3.SR.AssocLambda(K3.SR.ATuple([ "QUERY_1_1S1R_R__B",Float; "QUERY_1_1T_T__C",Float; "v2",Float ]),K3.SR.AVar("accv",Float),(K3.SR.Add((K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Var("v2")))),(K3.SR.Var("accv")))))),(K3.SR.Const(0.)),(K3.SR.Slice((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1S1R_R__B",Float; "QUERY_1_1T_T__C",Float ],Float)),[ "QUERY_1_1S1R_R__B",Float; "QUERY_1_1T_T__C",Float ]([ QUERY_1_1S1R_R__B,(K3.SR.Var("QUERY_1_1S1R_R__B")) ]))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Var("QUERY_1_1S1R_A")))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ],(K3.SR.Add((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Const(0.)))))))

ON_delete_T(QUERY_1_1R1S1T_T__C,QUERY_1_1R1S1T_D)
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1S1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C")) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1S1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C")) ])),(K3.SR.Mult((K3.SR.Var("QUERY_1_1R1S1T_D")),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1S1T_T__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1S1T_T__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Mult((K3.SR.Var("QUERY_1_1R1S1T_D")),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))))
K3.SR.Iterate((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1R_R__B",Float; "updated_v",Float ]),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R_R__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R_R__B")) ],(K3.SR.Var("updated_v")))))),(K3.SR.Map((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1R_R__B",Float; "dv",Float ]),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R_R__B")) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1R_R__B")); (K3.SR.Add((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R_R__B")) ])),(K3.SR.Var("dv")))) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1R_R__B")); (K3.SR.Add((K3.SR.Const(0.)),(K3.SR.Var("dv")))) ])))))),(K3.SR.GroupByAggregate((K3.SR.AssocLambda(K3.SR.ATuple([ "QUERY_1_1R_R__B",Float; "QUERY_1_1R1S1T_T__C",Float; "v1",Float ]),K3.SR.AVar("accv",Float),(K3.SR.Add((K3.SR.Mult((K3.SR.Var("QUERY_1_1R1S1T_D")),(K3.SR.Mult((K3.SR.Var("v1")),(K3.SR.Const(-1.)))))),(K3.SR.Var("accv")))))),(K3.SR.Const(0.)),(K3.SR.Slice((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R_R__B",Float; "QUERY_1_1R1S1T_T__C",Float ],Float)),[ "QUERY_1_1R_R__B",Float; "QUERY_1_1R1S1T_T__C",Float ]([ QUERY_1_1R1S1T_T__C,(K3.SR.Var("QUERY_1_1R1S1T_T__C")) ]))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1S1T_T__C")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Var("QUERY_1_1R1S1T_D")),(K3.SR.Const(-1.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1S1T_T__C")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1S1T_T__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1S1T_T__C")) ],(K3.SR.Add((K3.SR.Mult((K3.SR.Var("QUERY_1_1R1S1T_D")),(K3.SR.Const(-1.)))),(K3.SR.Const(0.)))))))

ON_delete_S(QUERY_1_1R1T1S_S__B,QUERY_1_1R1T1S_S__C)
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))))),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.Const(-1.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(-1.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))))),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Add((K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.Const(-1.)))),(K3.SR.Const(0.)))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Add((K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(-1.)))),(K3.SR.Const(0.)))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.Const(-1.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(-1.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ])))))))),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Add((K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.Const(-1.)))),(K3.SR.Const(0.)))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1R1T1S_S__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")) ],(K3.SR.Add((K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1S1",[ "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(-1.)))),(K3.SR.Const(0.)))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Const(-1.)))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1R1T1S_S__B",Float; "QUERY_1_1R1T1S_S__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1R1T1S_S__B")); (K3.SR.Var("QUERY_1_1R1T1S_S__C")) ],(K3.SR.Add((K3.SR.Const(-1.)),(K3.SR.Const(0.)))))))

ON_delete_R(QUERY_1_1S1R_A,QUERY_1_1S1R_R__B)
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Mult((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))),(K3.SR.PCValueUpdate((K3.SR.SingletonPC("QUERY_1_1",Float)),[  ],[  ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Mult((K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("init_val",Float),(K3.SR.Block([ (K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1R1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ],(K3.SR.Var("init_val")))); (K3.SR.Var("init_val")) ])))),(K3.SR.Const(0.)))),(K3.SR.Const(-1.)))))))))),(K3.SR.SingletonPC("QUERY_1_1",Float)))))))
K3.SR.Iterate((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1T_T__C",Float; "updated_v",Float ]),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1T_T__C",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1T_T__C")) ],(K3.SR.Var("updated_v")))))),(K3.SR.Map((K3.SR.Lambda(K3.SR.ATuple([ "QUERY_1_1T_T__C",Float; "dv",Float ]),(K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1T_T__C")) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1T_T__C")); (K3.SR.Add((K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1T1",[ "QUERY_1_1T_T__C",Float ],Float)),[ (K3.SR.Var("QUERY_1_1T_T__C")) ])),(K3.SR.Var("dv")))) ])),(K3.SR.Tuple([ (K3.SR.Var("QUERY_1_1T_T__C")); (K3.SR.Add((K3.SR.Const(0.)),(K3.SR.Var("dv")))) ])))))),(K3.SR.GroupByAggregate((K3.SR.AssocLambda(K3.SR.ATuple([ "QUERY_1_1S1R_R__B",Float; "QUERY_1_1T_T__C",Float; "v1",Float ]),K3.SR.AVar("accv",Float),(K3.SR.Add((K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Mult((K3.SR.Var("v1")),(K3.SR.Const(-1.)))))),(K3.SR.Var("accv")))))),(K3.SR.Const(0.)),(K3.SR.Slice((K3.SR.OutPC("QUERY_1_1R1T1",[ "QUERY_1_1S1R_R__B",Float; "QUERY_1_1T_T__C",Float ],Float)),[ "QUERY_1_1S1R_R__B",Float; "QUERY_1_1T_T__C",Float ]([ QUERY_1_1S1R_R__B,(K3.SR.Var("QUERY_1_1S1R_R__B")) ]))))))))
K3.SR.IfThenElse((K3.SR.Member((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ],(K3.SR.Apply((K3.SR.Lambda(K3.SR.AVar("current_v",Float),(K3.SR.Add((K3.SR.Var("current_v")),(K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Const(-1.)))))))),(K3.SR.Lookup((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ])))))),(K3.SR.PCValueUpdate((K3.SR.OutPC("QUERY_1_1S1",[ "QUERY_1_1S1R_R__B",Float ],Float)),[  ],[ (K3.SR.Var("QUERY_1_1S1R_R__B")) ],(K3.SR.Add((K3.SR.Mult((K3.SR.Var("QUERY_1_1S1R_A")),(K3.SR.Const(-1.)))),(K3.SR.Const(0.)))))))

;;

*)

test_compile 
   "on_insert_t" ["QUERY_1_1R1S1T_T__C";"QUERY_1_1R1S1T_D"]
   on_insert_t
   ""
         

;;
