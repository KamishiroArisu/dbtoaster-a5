\begin{comment}
\documentclass{article}

\usepackage{fullpage}

\usepackage{latexsym}
\usepackage{amsmath}
\usepackage{txfonts}
\usepackage{verbatim}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{metatheorem}{Metatheorem}[section]
\newtheorem{example}[theorem]{Example}
%\newtheorem{algorithm}[theorem]{Algorithm}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{property}[theorem]{Property}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{proviso}[theorem]{Proviso}
\newtheorem{todo}[theorem]{ToDo}

\newcommand{\tuple}[1]{{\langle#1\rangle}}

\begin{document}

\def\algsum{\mathrm{sum}}
\def\algagg{\mathrm{agg}}
\def\algtop{\mathrm{top}}
\def\algtopk{\mathrm{topk}}

\def\algnew{\mathrm{new}}
\def\algmin{\mathrm{min}}
\def\algmax{\mathrm{max}}
\def\algincr{\mathrm{incr}}
\def\algincrdiff{\mathrm{incrdiff}}
\def\alginsert{\mathrm{insert}}
\def\algupdate{\mathrm{update}}
\def\algdelete{\mathrm{delete}}
\def\algfor{\mathrm{foreach}}
\def\algavg{\mathrm{avg}}
\def\algsumr{\mbox{sumr}}
\def\algsumf{\mbox{sumf}}
\def\algaggf{\mbox{aggf}}
\def\algcount{\mbox{count}}
\def\distinct{\mbox{distinct}}
\def\routerjoin{\bowtie\!=}
\end{comment}
% ssb queries
\begin{tabular}{llll}
LO = LineOrder & orderkey & & long\\
& linenumber& &int\\
& custkey& ck& long\\
& partkey& pk& long\\
& suppkey& sk& long\\
& orderdate& od& string\\
& orderpriority& & string\\
& shippriority& & int\\
& quantity& & int\\
& extendedprice& & int\\
& ordtotalprice& & int\\
& discount& & int\\
& revenue& r& int\\
& supplycost& sc& int\\
& tax& & int\\
& commitdate& & string\\
& shipmode& & string\\\\
C = Customer & custkey&ck& long\\
& name& &string\\
& address& &string\\
& city& &string\\
& nation& n&string\\
& region& r&string\\
& phone& &string\\
& mktsegment& &string\\\\
S = Supplier & suppkey &sk& long\\
& name& &string\\
& address& &string\\
& city& c&string\\
& nation& &string\\
& region& r&string\\
& phone& &string\\\\
P = Part & partkey& pk&long\\
& name& &string\\
& mfgr& m&string\\
& category& c&string\\
& brand1& b&string\\
& color& &string\\
& type& &string\\
& size& &int\\
& container& &string\\\\
D = Date & datekey & dk&string\\
& year& y& int\\
\end{tabular}
\pagebreak

\begin{eqnarray}
q4\_1[y, n] &=& \algsum_{LO.R - LO.SC} 
  (\sigma_{\substack{ D.Y = y \wedge C.N = n \\\wedge LO.CK = C.CK \wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = D.DK \\\wedge C.R = 'AMERICA' \wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')}} (D \times C \times S \times P \times LO ))\\
q4\_2[y, n, c] &=& \algsum_{LO.R - LO.SC}
  (\sigma_{\substack{ D.Y = y \wedge S.N = n \wedge P.C = c \\\wedge LO.CK = C.CK \wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = D.DK \\\wedge C.R = 'AMERICA' \wedge S.R = 'AMERICA' \\\wedge (D.Y = 1997 \vee D.Y = 1998) \\\wedge ( P.M ='MFGR\#1' \vee P.M = 'MFGR\#2')}} (D \times C \times S \times P \times LO))\\
q4\_3[y, c, b] &=& \algsum_{LO.R - LO.SC}
  (\sigma_{\substack{ D.Y = y \wedge S.C = c \wedge P.B = b \\\wedge LO.CK = C.CK \wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = D.DK \\\wedge C.R = 'AMERICA' \wedge S.N = 'UNITED STATES' \\\wedge (D.Y = 1997 \vee D.Y = 1998) \wedge P.M ='MFGR\#14' }} (D \times C \times S \times P \times LO))
\end{eqnarray}
% Insert D to q4_1
on Insert D to $q4\_1$\\
\begin{eqnarray}
\algnew_{+D(\vec{d})} q4\_1[y,n] &=& \algnew_{+D(\vec{d})} \algsum_{LO.R - LO.SC} 
  (\sigma_{\substack{ \dots}} (D \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\Delta_{+D(\vec{d})} \algsum_{LO.R - LO.SC} 
  (\sigma_{\substack{ \dots}} (D \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\;\algsum_{LO.R - LO.SC} 
  (\Delta_{+D(\vec{d})}  \sigma_{\substack{\dots}} (D \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\;\algsum_{LO.R - LO.SC} 
  ( \sigma_{\substack{ \dots}} \Delta_{+D(\vec{d})}(D \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\;\algsum_{LO.R - LO.SC} 
  ( \sigma_{\substack{ \dots}} ((\Delta_{+D(\vec{d})}D) \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\;\algsum_{LO.R - LO.SC} 
  ( \sigma_{\substack{ \dots}} ((\pi_{\vec{d}}\{\tuple{}\}) \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\;\algsum_{LO.R - LO.SC} 
  (\pi_{\vec{d}} \sigma_{\substack{year = y \wedge C.N = n \\\wedge LO.CK = C.CK \wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = datekey \\\wedge C.R = 'AMERICA' \wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} ( \{\tuple{}\} \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\;\algsum_{LO.R - LO.SC} 
  ( \sigma_{\substack{year = y \wedge C.N = n \\\wedge LO.CK = C.CK \wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = datekey \\\wedge C.R = 'AMERICA' \wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} ( \{\tuple{}\} \times C \times S \times P \times LO ))\\
&=& \algincr_{q4\_1}\; 
  ( \algsum_{1} (\sigma_{year = y} \{\tuple{}\} * \\\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC}\sigma_{\substack{C.N = n \wedge LO.CK = C.CK \\\wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = datekey \\\wedge C.R = 'AMERICA' \wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} ( C \times S \times P \times LO ))}_{S_{D}[datekey, n]}
\end{eqnarray}
\begin{comment}
% S_{D}
\begin{eqnarray}
S_{D1} [\rho_{DK} D,n] &=& \algsum_{LO.R - LO.SC}\sigma_{\substack{C.N = n \wedge LO.CK = C.CK \\\wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = x \\\wedge C.R = 'AMERICA' \wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} ( C \times S \times P \times LO ))
\end{eqnarray}
\end{comment}
% on insert C into S_D
on Insert C into $S_{D}$
\begin{eqnarray}
\algnew_{+C(\vec{c})} S_{D} [dk = \rho_{DK}D, n] &=& \algnew_{+C(\vec{c})} \algsum_{LO.R - LO.SC}
  ( \sigma_{\dots} ( C \times S \times P \times LO ))[\algnew_{+C(\vec{c})}\rho_{DK}D,n]\\
&=& \algincr_{S_{C, D1}} \algsum_{LO.R - LO.SC}
  ( \sigma_{\substack{ nation = n \wedge LO.CK = costkey \wedge\\ LO.SK = S.SK \wedge LO.PK = P.PK \wedge LO.OD = dk \\\wedge region = 'AMERICA' \wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} (  \{\tuple{}\} \times S \times P \times LO ))[\dots]\\
&=& \algincr_{S_{C, D1}} 
\algsum_{1} (\sigma_{nation = n \wedge region = `AMERICA'} \{\tuple{}\}) *   
\\\nonumber&& \qquad 
\underbrace{ \algsum_{LO.R - LO.SC}( \sigma_{\substack{ LO.CK = costkey \wedge LO.SK = S.SK \wedge LO.PK = P.PK \\\wedge LO.OD = dk \wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} ( S \times P \times LO ))}_{s_{CD}[dk, costkey]} [\dots]\\
\end{eqnarray}
% on insert S into s_CD
on insert S into $s_{CD}$
\begin{eqnarray}
\algnew_{+S(\vec{s})} s_{CD} [dk, ck = \rho_{CK} C] &=& 
\algincr_{s_{CD}} 
\algsum_{1} (\sigma_{region = `AMERICA'} \{\tuple{}\}) *
\\\nonumber&&\qquad
\underbrace{\algsum_{LO.R - LO.SC}( \sigma_{\substack{ LO.CK = ck \wedge LO.SK = suppkey \\\wedge LO.PK = P.PK \wedge LO.OD = dk  \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} ( P \times LO ))}_{s_{SCD}[dk. ck, suppkey]}
\end{eqnarray}
%on insert P into s_SCD
on insert P into $s_{SCD}$
\begin{eqnarray}
\algnew_{+P(\vec{p})} sSCD_{1} [ dk, ck, sk = \rho_{SK} S]
&=& \algincr_{sSCD_{1}}
\algsum_{1} (\sigma_{mfgr = `MFGR\#1' \vee mfgr = `MFGR\#2'} \{\tuple{}\}) *
\\\nonumber&&\qquad
\underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ LO.CK = ck \wedge LO.SK = sk \\\wedge LO.PK = partkey \wedge LO.OD = dk}} LO)}_{s1_{LO}[dk,ck,sk, partkey]}
\end{eqnarray}
%on insert LO into s1_LO
on insert LO into $s1_{LO}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} s1_{LO} [dk, ck, sk, pk = \rho_{PK} P] &=&
\algincr_{s1_{LO}} 
\algsum_{revenue - supplycost} (\sigma_{\substack{ custkey = ck \wedge suppkey = sk \\\wedge partkey = pk \wedge orderdate = dk}} \{\tuple{}\} ) 
\end{eqnarray}
%on insert LO into s_SCD
on insert LO into $s_{SCD}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} s_{SCD} [dk, ck, sk] 
&=& \algincr_{sSCD_{1}}
\algsum_{revenue - supplycost} (\sigma_{custkey = ck \wedge suppkey = sk \wedge orderdate = dk} \{\tuple{}\}) *
\\\nonumber&&\qquad
\underbrace{\algsum_{1} (\sigma_{P.PK = partkey \wedge (P.M = `MFGR\#1' \vee P.M = `MFGR\#2')} P)}_{s1_{P}[partkey]} 
\end{eqnarray}
% on insert P into s1_P
on insert P into $s1_{P}$
\begin{eqnarray}
\algnew_{+P(\vec{p})} s1_{P} [pk = \rho_{PK} LO] &=&
\algincr_{s1_{P}} \algsum_{1} ( \sigma_{partkey = pk \wedge (mfgr = `MFGR\#1' \vee mfgr = `MFGR\#2')} \{\tuple{}\})
\end{eqnarray}
% on insert P into s_CD
on insert P into $s_{CD}$
\begin{eqnarray}
\algnew_{+P(\vec{p})} s_{CD} [dk, ck] &=& 
\algincr_{s_{CD}} \algsum_{1} (\sigma_{mfgr = `MFGR\#1' \vee mfgr = `MFGR\#2'} \{\tuple{}\}) *
\\\nonumber&&\qquad
\underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{LO.CK = ck \wedge LO.SK = S.SK \wedge LO.PK = partkey \\\wedge LO.OD = dk \wedge S.R = `AMERICA' }} (S \times LO) )}_{s_{PCD}[dk,ck,partkey]}
\end{eqnarray}
% on insert S into s_PCD
on insert S into $s_{PCD}$
\begin{eqnarray}
\algnew_{+S(\vec{s})} s_{PCD} [dk, ck, pk = \rho_{PK} P] &=& 
\algincr_{s_{PCD}} \algsum_{1} (\sigma_{region = `AMERICA'} \{\tuple{}\}) *
\\\nonumber&&\qquad
\underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{LO.CK = ck \wedge LO.SK = suppkey \\\wedge LO.PK = pk \wedge LO.OD = dk }} (LO) )}_{s1_{LO}[dk, ck, suppkey, pk]}
\end{eqnarray}
%on insert LO into s_PCD
on insert LO into $s_{PCD}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} s_{PCD} [dk,ck,pk] &=&
\algincr_{s_{PCD}}  \underbrace{\algsum_{1} (\sigma_{S.R = `AMERICA' \wedge S.SK = suppkey}S)}_{s1_{R}[suppkey]} * 
\\\nonumber&&\qquad
\algsum_{revenue-supplycost} (\sigma_{custkey = ck \wedge partkey = pk \wedge orderdate = dk} \{\tuple{}\})
\end{eqnarray}
% on insert S into s1_R
on insert S into $s1_{R}$
\begin{eqnarray}
\algnew_{+S(\vec{s})} s1_{R} [sk] &= &
\algincr_{s1_{R}} \algsum_{1} (\sigma_{region = `AMERICA' \wedge suppkey = sk} \{\tuple{}\})
\end{eqnarray}
% on insert LO into s_CD
on insert LO into $s_{CD}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} s_{CD} [x,y] &=&
\algincr_{s_{CD}} \algsum_{revenue-supplycost} (\sigma_{custkey = y \wedge orderdate = x} \{\tuple{}\} ) *
\\\nonumber&& \qquad
s1_{P} [partkey] * s1_{R} [suppkey]
\end{eqnarray}
\\
% on insert S into S_D
on insert S into $S_{D}$
\begin{eqnarray}
\algnew_{+S(\vec{s})} S_{D} [dk, n] &=& \algincr_{S_{S, D1}}
\algsum_{1} (\sigma_{region = `AMERICA'} \{\tuple{}\}) *   
\\\nonumber&& \qquad 
\underbrace{ \algsum_{LO.R - LO.SC}( \sigma_{\substack{ C.N = n \wedge LO.CK = C.CK \wedge LO.SK = suppkey \\\wedge LO.PK = P.PK \wedge LO.OD = dk \wedge C.R = `AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')
}} ( C \times P \times LO ))}_{s_{SD}[dk, suppkey, n]} [\dots]\\
\end{eqnarray}
% on insert C into S_SD
on insert C into $s_{SD}$
\begin{eqnarray}
\algnew_{+C (\vec{c })} s_{SD} [dk, sk, n ] &=& \algincr_{s_{SD }}
\algsum_{1} (\sigma_{nation = n \wedge region = `AMERICA'} \{\tuple{}\}) * s_{SCD}[dk, custkey, sk]
%\\\nonumber&& \qquad
%\underbrace{ \algsum_{LO.R - LO.SC} ( \sigma_{\substack{LO.CK = custkey \wedge LO.SK = sk \\\wedge LO.PK = P.PK \wedge LO.OD = dk \wedge (P.M = `MFGR\#1' \vee P.M = `MFGR\#2')}} ( P \times LO))}_{s_{SCD}[dk, custkey, sk]}
\end{eqnarray}
% on insert P into s_SD
on insert P into $s_{SD}$
\begin{eqnarray}
\algnew_{+P (\vec{p})} s_{SD} [dk, sk, n] &=& \algincr_{s_{SD}}
\algsum_{1} (\sigma_{mfgr = `MFGR\#1' \vee mfgr = `MFGR\#2'} \{\tuple{}\}) *
\\\nonumber&& \qquad
\underbrace{ \algsum_{LO.R - LO.SC} (\sigma_{\substack{C.N = n \wedge LO.CK = C.CK \wedge LO.SK = sk \\\wedge LO.PK = partkey \wedge LO.OD = dk }} (C \times LO)}_{s_{PSD}[dk, sk, partkey, n]}
\end{eqnarray}
% on insert C into s_PSD
on insert C into $s_{PSD}$
\begin{eqnarray}
\algnew_{+ C(\vec{c })} s_{PSD} [dk, sk, pk, n ] &=& \algincr_{s_{PSD}}
\algsum_{1} (\sigma_{nation = n } \{\tuple{}\}) * s1_{LO}[dk, custkey, sk, pk]
%\\\nonumber&& \qquad
%\underbrace{ \algsum_{LO.R - LO.SC} (\sigma_{\substack{LO.CK = custkey \wedge LO.SK = sk \\\wedge LO.PK = pk \wedge LO.OD = dk }} (LO)}_{s1_{LO}[dk, custkey, sk, pk]} 
\end{eqnarray}
% on insert LO into s_PSD
on insert LO into $s_{PSD}$
\begin{eqnarray}
\algnew_{+LO (\vec{lo})} s_{PSD} [dk, sk, pk, n] &=& \algincr_{s_{PSD}}
\underbrace{\algsum_{1} (\sigma_{C.N = n \wedge C.CK = custkey} C)}_{s1_{C}[custkey, n]} *
\\\nonumber&& \qquad
\algsum_{revenue-supplycost} (\sigma_{suppkey = sk \wedge partkey = pk \wedge orderdate = dk} \{\tuple{}\})
\end{eqnarray}
% on insert C into s1_C
on insert C into $s1_{C}$
\begin{eqnarray}
\algnew_{+C (\vec{c})} s1_{C} [ck, n] &=& \algincr_{s1_{C}}
\algsum_{1} (\sigma_{nation = n \wedge custkey = ck} \{\tuple{}\})
\end{eqnarray}
\\
% on insert LO into s_SD
on insert LO into $s_{SD}$
\begin{eqnarray}
\algnew_{+LO (\vec{lo})} s_{SD} [dk, sk, n] &=& \algincr_{s_{SD}}
\algsum_{revenue-supplycost} (\sigma_{suppkey = sk \wedge orderdate = dk} \{\tuple{}\} ) * 
\\\nonumber&& \qquad
s1_{C}[custkey] * s1_{P} [partkey]
\end{eqnarray}
\\
% on insert P into S_D
on insert P into $S_{D}$
\begin{eqnarray}
\algnew_{+P(\vec{p})} S_{D} [dk, n] &=& \algincr_{s_{D}}
\algsum_{1} (\sigma_{mkfg = `MFGR\#1' \vee mfgr = `MFGR\#2' } \{\tuple{}\}) *   
\\\nonumber&& \qquad 
\underbrace{ \algsum_{LO.R - LO.SC}( \sigma_{\substack{ C.N = n \wedge LO.CK = C.CK \wedge LO.SK = S.SK \\\wedge LO.PK = partkey \wedge LO.OD = dk \\\wedge C.R = `AMERICA' \wedge  S.R = `AMERICA' }} ( C \times S \times LO ))}_{s_{PD}[dk, pk, n]}\\
\end{eqnarray}
\\
% on insert C into s_PD
on insert C into $s_{PD}$
\begin{eqnarray}
\algnew_{+C(\vec{c})} S_{PD} [dk, pk, n] &=& \algincr_{s_{PD}}
\algsum_{1} (\sigma_{nation = n \wedge region = `AMERICA'} \{\tuple{}\} )* s_{PCD}[dk, custkey, pk]
%\\\nonumber&& \qquad
%\underbrace{ \algsum_{LO.R - LO.SC} ( \sigma_{\substack{LO.CK = custkey \wedge LO.SK = S.SK \\\wedge LO.PK = pk \wedge LO.OD = dk \wedge S.R = `AMERICA' }} (S \times LO))}_{s_{PCD}[dk, custkey, pk]}
\end{eqnarray}
% on insert S into s_PD
on insert S into $s_{PD}$
\begin{eqnarray}
\algnew_{+S(\vec{s})} S_{PD} [dk, pk, n] &=& \algincr_{s_{PD}}
\algsum_{1} (\sigma_{region = `AMERICA'} \{\tuple{}\} )* s_{PSD} [dk, suppkey, pk, n]
%\\\nonumber&& \qquad
%\underbrace{ \algsum_{LO.R - LO.SC} ( \sigma_{\substack{C.N = n \wedge LO.CK = C.CK \wedge LO.SK = suppkey \\\wedge LO.PK = pk \wedge LO.OD = dk }} (C \times LO))}_{s_{PSD}[dk, suppkey, pk, n]}
\end{eqnarray}
% on insert LO into s_PD
on insert LO into $s_{PD}$
\begin{eqnarray}
\algnew_{+LO (\vec{lo})} s_{PD} [dk, pk, n] &=& \algincr_{s_{PD}}
\algsum_{revenue-supplycost} (\sigma_{partkey = pk \wedge orderdate = dk} \{\tuple{}\} ) * 
\\\nonumber&& \qquad
s1_{C}[custkey, n] * s1_{S} [suppkey]
\end{eqnarray}
\\
% on insert LO into S_D
on insert LO into $S_{D}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{D} [dk, n] 
%\algincr_{S_{LO, D1}}
%\algsum_{revenue-supplycost} (\sigma_{orderdate = x} \{\tuple{}\}) *   
%\\\nonumber&& \quad 
%\algsum_{1} (\sigma_{C.N = n \wedge C.CK = custkey \wedge C.R = `AMERICA'} C) *
%\algsum_{1} (\sigma_{S.SK = suppkey \wedge S.R = `AMERICA'} S) *
%\\\nonumber&& \quad 
%\algsum_{1} (\sigma_{P.PK = partkey \wedge (P.M = `MFGR\#1' \vee P.M = `MFGR\#2')} P)\\
&=& \algincr_{S_{LOD}}
\algsum_{revenue-supplycost} (\sigma_{orderdate = x} \{\tuple{}\}) *   
\\\nonumber&& \quad s1_{C} [custkey, n] * s1_{S} [suppkey] * s1_{P} [partkey]
\end{eqnarray}
\\
% Insert C into q4_1
on Insert C into $q4_1$\
\begin{eqnarray}
\algnew_{+C(\vec{c})} q4\_1[y,n] &=&  \algincr_{q4\_1} \algsum_{1} (\sigma_{nation = n \wedge region = `AMERICA'}  \{\tuple{}\}) * \\
\nonumber&&\quad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge  LO.CK = custkey \\\wedge LO.SK = S.SK \\\wedge LO.PK = P.PK \wedge LO.OD = D.DK \\\wedge S.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')}} (D \times S \times P \times LO))}_{s_{C}[ custkey, y]}
\end{eqnarray}
\\
% on insert D into s_C
on Insert D into $s_C$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{C} [ck, y] &=& \algincr_{S_{C}}
\algsum_{1} (\sigma_{year = y} \{\tuple{}\}) * s_{CD} [datekey, ck]
\end{eqnarray}
% on insert S into s_C
on Insert S into $s_C$
\begin{eqnarray}
\algnew_{+S(\vec{s})} S_{C} [ck, y] &=& \algincr_{S_{C}}
\algsum_{1} (\sigma_{region = `AMERICA' } \{\tuple{}\}) * \\
\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge  LO.CK = ck \wedge LO.SK = suppkey \\\wedge LO.PK = P.PK \wedge LO.OD = D.DK \\\wedge  ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')}} (D \times P \times LO)}_{s_{SC}[ck, suppkey, y]}
\end{eqnarray}
% on insert D into s_SC
on Insert D into $s_{SC}$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{SC} [ck, sk, y] &=& \algincr_{S_{SC}}
\algsum_{1} (\sigma_{year = y } \{\tuple{}\}) * s_{SCD} [datekey, ck, sk] 
\end{eqnarray}
% on insert P into s_SC
on Insert P into $s_{SC}$
\begin{eqnarray}
\algnew_{+P(\vec{p})} S_{SC} [ck, sk, y] &=& \algincr_{S_{SC}}
\algsum_{1} (\sigma_{ mfgr = 'MFGR\#1' \vee mfgr = 'MFGR\#2' } \{\tuple{}\}) * \\
\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge  LO.CK = ck \wedge LO.SK = sk \\\wedge LO.PK = partkey \wedge LO.OD = D.DK }} (D \times LO)}_{s_{PSC}[ck, sk, partkey, y]}
\end{eqnarray}
% on insert D into s_PSC
on Insert D into $s_{PSC}$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{PSC} [ck, sk, pk, y] &=& \algincr_{S_{PSC}}
\algsum_{1} (\sigma_{year = y} \{\tuple{}\}) * s1_{LO} [datekey, ck, sk, pk]
\end{eqnarray}
% on insert LO into s_PSC
on Insert LO into $s_{PSC}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{PSC} [ck, sk, pk, y] &=& \algincr_{S_{PSC}}
\algsum_{revenue-supplycost} (\sigma_{custkey = ck \wedge suppkey = sk \wedge partkey = partkey} \{\tuple{}\}) *
\\\nonumber&&\qquad \underbrace{\algsum_{1} (\sigma_{D.Y = y \wedge D.DK = orderdate} D)}_{s1_{D}[orderdate, y]}
\end{eqnarray}
% on insert D into s1_D
on Insert D into $s1_{D}$
\begin{eqnarray}
\algnew_{+D(\vec{d})} s1_{D} [dk, y] &=&
\algincr_{s1_{D}} \algsum_{1} (\sigma_{year = y \wedge datekey = dk} \{\tuple{}\})
\end{eqnarray}
\\
% on insert LO into s_SC
on Insert LO into $s_{SC}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} s_{SC} [ck, sk, y] &=& \algincr_{s_{SC}}
\algsum_{revenue-supplycost} (\sigma_{custkey = ck \wedge suppkey = sk} \{\tuple{}\}) * 
\\\nonumber&&\qquad  s1_{D}[orderdate, y] * s1_{P}[partkey]
\end{eqnarray}
\\
% on insert P into s_C
on Insert P into $s_C$
\begin{eqnarray}
\algnew_{+P(\vec{p})} S_{C} [ck, y] &=& \algincr_{S_{C}}
\algsum_{1} (\sigma_{mfgr = 'MFGR\#1' \vee mfgr = 'MFGR\#2'} \{\tuple{}\}) * 
\\\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge  LO.CK = ck \\\wedge LO.SK = S.SK \\\wedge LO.PK = partkey \wedge LO.OD = D.DK \\\wedge S.R = 'AMERICA' }} ( D \times S \times LO) }_{s_{PC} [ck, partkey, y]}
\end{eqnarray}
% on insert D into s_PC
on Insert D into $s_{PC}$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{PC} [ck, pk, y] &=& \algincr_{S_{PC}}
\algsum_{1} (\sigma_{year = y} \{\tuple{}\}) * s_{PCD} [datekey, ck, pk]
\end{eqnarray}
% on insert S into s_PC
on Insert S into $s_{PC}$
\begin{eqnarray}
\algnew_{+S(\vec{s})} S_{PC} [ck, pk, y] &=& \algincr_{S_{PC}}
\algsum_{1} (\sigma_{region = `AMERICA'} \{\tuple{}\}) * s_{PSC} [ck, suppkey, pk, y]
\end{eqnarray}
% on insert LO into s_PC
on Insert LO into $s_{PC}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{PC} [ck, pk, y] &=& \algincr_{S_{PC}}
\algsum_{revenue-supplycost} (\sigma_{custkey = ck \wedge partkey = pk} \{\tuple{}\}) * 
\\\nonumber&&\qquad s1_{D}[orderdate, y] * s1_{S}[suppkey]
\end{eqnarray}
\\
% on insert LO into s_C
on Insert LO into $s_C$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{C} [ck, y] &=& \algincr_{S_{C}}
\algsum{revenue-supplycost} (\sigma_{custkey = ck} \{\tuple{}\}) * s1_{D} [orderdate, y] * \\\nonumber&&\qquad s1_{S} [suppkey] * s1_{P} [partkey]
\end{eqnarray}
\\\\
% Insert S into q4_1
on Insert S into $q4_1$\\
\begin{eqnarray}
\algnew_{+S(\vec{s})} q4\_1[y,n] &=& 
\algincr_{q4\_1} \algsum_{1} (\sigma_{region = `AMERICA'} \{\tuple{}\}) *\\
\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge C.N = n \wedge LO.CK = C.CK \\\wedge LO.SK = suppkey \wedge LO.PK = P.PK \\\wedge LO.OD = D.DK \wedge C.R = 'AMERICA' \\\wedge ( P.M = 'MFGR\#1' \vee P.M = 'MFGR\#2')}} (D \times  C \times P \times LO))}_{s_{S}[suppkey, y, n]}
\end{eqnarray}
% on Insert D into s_S
on Insert D into $s_S$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{S} [sk, y, n] &=& \algincr_{S_{S}}
\algsum_{1} (\sigma_{year = y} \{\tuple{}\}) * s_{SD} [datekey, sk, n]
\end{eqnarray}
% on Insert C into s_S
on Insert C into $s_S$
\begin{eqnarray}
\algnew_{+C(\vec{c})} S_{S} [sk, y, n] &=& \algincr_{S_{S}}
\algsum_{1} (\sigma_{nation = n \wedge region  =`AMERICA'} \{\tuple{}\}) * s_{SC}[custkey, sk, y]
\end{eqnarray}
% on Insert P into s_S
on Insert P into $s_S$
\begin{eqnarray}
\algnew_{+P(\vec{p})} S_{S} [sk, y, n] &=& \algincr_{S_{S}}
\algsum_{1} (\sigma_{mfgr = 'MFGR\#1' \vee mfgr = 'MFGR\#2'} \{\tuple{}\}) * 
\\\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge C.N = n \wedge LO.CK = C.CK \\\wedge LO.SK = sk \wedge LO.PK = partkey \\\wedge LO.OD = D.DK \wedge C.R = 'AMERICA' }} (D \times  C \times LO))}_{s_{PS}[sk, partkey, y, n]}
\end{eqnarray}
% on Insert D into s_PS
on Insert D into $s_{PS}$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{PS} [sk, pk, y, n] &=& \algincr_{S_{PS}}
\algsum_{1} (\sigma_{year = y} \{\tuple{}\} ) * s_{PSD} [datekey, sk, pk, n]
\end{eqnarray}
% on Insert C into s_PS
on Insert C into $s_{PS}$
\begin{eqnarray}
\algnew_{+C(\vec{c})} S_{PS} [sk, pk, y, n] &=& \algincr_{S_{PS}}
\algsum_{1} (\sigma_{nation = n \wedge region = `AMERICA'} \{\tuple{}\} ) * s_{PSC}[custkey, sk, pk, y]
\end{eqnarray}
% on Insert LO into s_PS
on Insert LO into $s_{PS}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{PS} [sk, pk, y, n] &=& \algincr_{S_{PS}}
\algsum_{revenue - supplycost} (\sigma_{suppkey = sk \wedge partkey = pk} \{\tuple{}\} ) * 
\\\nonumber&&\qquad s1_{D}[orderdate, y] * s1_{C}[custkey]
\end{eqnarray}
\\
% on Insert LO into s_S
on Insert LO into $s_S$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{S} [sk, y, n] &=& \algincr_{S_{S}}
\algsum_{revenue - supplycost} ( \sigma_{suppkey = sk} \{\tuple{}\}) * s1_{D}[orderdate, y] *
\\\nonumber&&\qquad  s1_{C}[custkey] * s1_{P} [partkey]
\end{eqnarray}
\\\\
% Insert P into q4_1
on Insert P into $q4_1$
\begin{eqnarray}
\algnew_{+P(\vec{p})} q4\_1[y,n] &=& 
\algincr_{q4\_1} \algsum_{1} (\sigma_{mfgr = 'MFGR\#1' \vee mfgr = 'MFGR\#2'} \{\tuple{}\}) * \\
\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge C.N = n \\\wedge LO.CK = C.CK \wedge LO.SK = S.SK \\\wedge LO.PK = partkey \wedge LO.OD = D.DK \\\wedge C.R = 'AMERICA' \wedge S.R = 'AMERICA' }} (D \times  C \times S \times LO))}_{s_{P} [partkey, y, n]}
\end{eqnarray}
% on Insert D into s_P
on Insert D into $s_{P}$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{P} [pk, y, n] &=& \algincr_{S_{P}}
\algsum_{1} (\sigma_{year = y} \{\tuple{}\}) * s_{PD} [datekey, pk, n]
\end{eqnarray}
% on Insert C into s_P
on Insert C into $s_{P}$
\begin{eqnarray}
\algnew_{+C(\vec{c})} S_{P} [pk, y, n] &=& \algincr_{S_{P}}
\algsum_{1} (\sigma_{nation = n \wedge region = `AMERICA'} \{\tuple{}\}) * s_{PC} [custkey, pk, y]
\end{eqnarray}
% on Insert S into s_P
on Insert S into $s_{P}$
\begin{eqnarray}
\algnew_{+S(\vec{s})} S_{P} [pk, y, n] &=& \algincr_{S_{P}}
\algsum_{1} (\sigma_{region = `AMERICA'} \{\tuple{}\} * 
\\\nonumber&&\qquad \underbrace{\algsum_{LO.R - LO.SC} (\sigma_{\substack{ D.Y = y \wedge C.N = n \\\wedge LO.CK = C.CK \wedge LO.SK = suppkey \\\wedge LO.PK = partkey \wedge LO.OD = D.DK \\\wedge C.R = 'AMERICA' }} (D \times  C \times  LO))}_{s_{SP} [pk, suppkey, y, n]}
\end{eqnarray}
% on Insert D into s_SP
on Insert D into $s_{SP}$
\begin{eqnarray}
\algnew_{+D(\vec{d})} S_{SP} [pk, sk, y, n] &=& \algincr_{S_{SP}}
\algsum_{1} (\sigma_{ year = y } \{\tuple{}\} * s_{PSD} [datekey, sk, pk, n]
\end{eqnarray}
% on Insert C into s_SP
on Insert C into $s_{SP}$
\begin{eqnarray}
\algnew_{+C(\vec{c})} S_{SP} [pk, sk, y, n] &=& \algincr_{S_{SP}}
\algsum_{1} (\sigma_{ nation = n \wedge region = `AMERICA'} \{\tuple{}\} * s_{PSC}[custkey, sk, pk, y]
\end{eqnarray}
% on Insert D into s_SP
on Insert LO into $s_{SP}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{SP} [pk, sk, y, n] &=& \algincr_{S_{SP}}
\algsum_{revenue - supplycost} (\sigma_{ suppkey = sk \wedge partkey = pk} \{\tuple{}\}) * 
\\\nonumber&&\qquad s1_{D}[orderdate, y] * s1_{C}[custkey]
\end{eqnarray}
\\
% on Insert D into s_P
on Insert LO into $s_{P}$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} S_{P} [pk, y, n] &=& \algincr_{S_{P}}
\algsum_{revenue - supplycost} (\sigma_{ partkey = pk} \{\tuple{}\}) * s1_{D}[orderdate, y] 
\\\nonumber&&\qquad * s1_{C}[custkey] * s1_{P}[partkey]
\end{eqnarray}
\\
% Insert LO into q4_1
on Insert LO into $q4_1$
\begin{eqnarray}
\algnew_{+LO(\vec{lo})} q4\_1[y,n] 
 &=& \algincr_{q4\_1} s1_{D}[orderdate, y] *s1_{C} [custkey, n] *  s1_{S} [suppkey]* s1_{P} [partkey] *\\
\nonumber&& (revenue - supplycost) 
\end{eqnarray}

\pagebreak
\begin{verbatim}
on Insert D
\end{verbatim}
\begin{comment}
\end{document}
\end{comment}